/*
 * @file tools.min,js
 * @description minified cookie.js widgets.js calendar.js (with calendar gen)
 * @date 2012.02.01 10:00
 * @author swdalex (Alexey Chavkin) <swdalex@gmail.com>
 * @copyright Copyright (c) 2012, MegaGroup http://megagroup.ru
 * @version 1.2 (2012.03.06)
 */

function createCookie(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString()}else c="";document.cookie=a+"="+encodeURIComponent(b)+c+"; path=/"}function readCookie(a){for(var a=a+"=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null}function eraseCookie(a){createCookie(a,"",-1)}
var widgets={addToCart:function(a,b,c,d){var e=1,b=Number(b),c=Number(c);$.post("/my/s3/export/shop/product.php",{mode:"json",action:"get-product",shop_id:a,product_id:b},function(f){f&&void 0!=f.product_price&&(c=Number(f.product_price));var h=!0,i=e,o="1"==f.product_amount_limit?!0:!1;o&&(i=Number(f.product_amount),i<e&&(e=i));if(!isNaN(a)&&0<a&&!isNaN(b)&&0<b&&!isNaN(c)&&!isNaN(e)&&0<e){var g="",k,m=!1,f=0,l=readCookie("CART_TOTAL_"+a),p=unescape(readCookie("CART_"+a)).split(";");isNaN(l)&&(l=
Number(l));for(var n=0;n<p.length;n++)k=p[n].split("="),2==k.length&&(!m&&k[0]==b?(o&&k[1]>=i||(l=Number(l)+c*e),k=e+Number(k[1]),k>i&&(k=i,h=!1,widgets.msg(window._s3Lang.JS_SHOP_PRODUCT_AMOUNT_TOTAL+": "+i,d)),m=!0,""!=g&&(g+=";"),g=g+b+"="+k,f+=k):(""!=g&&(g+=";"),g=g+k[0]+"="+k[1],f+=Number(k[1])));m||(""!=g&&(g+=";"),g=g+b+"="+e,l=Number(l)+c*e,f+=e);l=Math.round(100*l)/100;createCookie("CART_"+a,g,10);createCookie("CART_TOTAL_"+a,l,10);createCookie("CART_TOTAL_AMOUNT_"+a,f,10);if(i=document.getElementById("cart_total"))i.innerHTML=
l;if(i=document.getElementById("cart_total_amount"))i.innerHTML=f;h&&widgets.msg(window._s3Lang.JS_ADDED,d);return!0}},"json");return!1},formatPrice:function(a,b,c){"string"!=typeof a&&(a=""+a);null==b&&(b=" ");null==c&&(c=".");"."!=c&&(a=a.replace(".",c));var d=a.split(c),e=[];if(4<=d[0].length){for(a=d[0].length-1,j=1;0<=a;--a,++j)e.unshift(d[0].charAt(a)),0==j%3&&0<a&&e.unshift(b);return e.join("")+(d[1]?c+d[1]:"")}return a},addOnloadEvent:function(a){var b=window.onload;window.onload="function"!=
typeof window.onload?a:function(){b&&b();a()}},msg:function(a,b){if(b){var c=findPos(b),d=document.createElement("DIV");d&&(d.style.position="absolute",d.innerHTML=a,d.style.display="block",d.className="added-to-cart",d.style.left=c.x+b.offsetWidth+"px",d.style.top=c.y+b.offsetHeight+"px",document.body.appendChild(d),window.setTimeout(function(){d&&d.parentNode&&d.parentNode.removeChild(d);delete d},1500))}}};
function findPos(a){var b={x:0,y:0};if(a.offsetParent)for(;a.offsetParent;)b.y+=a.offsetTop,b.x+=a.offsetLeft,a=a.offsetParent;else a.x&&(b.x+=a.x),a.y&&(b.y+=a.y);return b}
var A_TCALDEF={months:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),weekdays:"Su,Mo,Tu,We,Th,Fr,Sa".split(","),yearscroll:!0,weekstart:0,centyear:70,imgpath:"/my/s3/images/calendar/"},RU_TCALDEF={months:"\u042f\u043d\u0432\u0430\u0440\u044c,\u0424\u0435\u0432\u0440\u0430\u043b\u044c,\u041c\u0430\u0440\u0442,\u0410\u043f\u0440\u0435\u043b\u044c,\u041c\u0430\u0439,\u0418\u044e\u043d\u044c,\u0418\u044e\u043b\u044c,\u0410\u0432\u0433\u0443\u0441\u0442,\u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c,\u041e\u043a\u0442\u044f\u0431\u0440\u044c,\u041d\u043e\u044f\u0431\u0440\u044c,\u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(","),weekdays:"\u0412\u0441,\u041f\u043d,\u0412\u0442,\u0421\u0440,\u0427\u0442,\u041f\u0442,\u0421\u0431".split(","),
yearscroll:!0,weekstart:1,centyear:70,imgpath:"/my/s3/images/calendar/"};
function f_tcalParseDate(a){if(!/^\s*(\d{1,2})\.(\d{1,2})\.(\d{2,4})\s*$/.exec(a))return alert("Invalid date: '"+a+"'.\nAccepted format is mm/dd/yyyy.");var a=Number(RegExp.$1),b=Number(RegExp.$2),c=Number(RegExp.$3);100>c&&(c+=c<this.a_tpl.centyear?2E3:1900);if(1>b||12<b)return alert("Invalid month value: '"+b+"'.\nAllowed range is 01-12.");var d=new Date(c,b,0);return a>d.getDate()?alert("Invalid day of month value: '"+a+"'.\nAllowed range for selected month is 01 - "+d.getDate()+"."):new Date(c,
b-1,a)}function f_tcalGenerDate(a){return(10>a.getDate()?"0":"")+a.getDate()+"."+(9>a.getMonth()?"0":"")+(a.getMonth()+1)+"."+a.getFullYear()}
function tcal(a,b){b||(b=a.lang&&"ru"==a.lang?RU_TCALDEF:A_TCALDEF);window.A_TCALS||(window.A_TCALS=[]);window.A_TCALSIDX||(window.A_TCALSIDX=[]);this.s_id=a.id?a.id:A_TCALS.length;window.A_TCALS[this.s_id]=this;window.A_TCALSIDX[window.A_TCALSIDX.length]=this;this.f_show=f_tcalShow;this.f_hide=f_tcalHide;this.f_toggle=f_tcalToggle;this.f_update=f_tcalUpdate;this.f_relDate=f_tcalRelDate;this.f_parseDate=f_tcalParseDate;this.f_generDate=f_tcalGenerDate;this.s_iconId="tcalico_"+this.s_id;this.e_icon=
f_getElement(this.s_iconId);if(!this.e_icon){var c=document.createElement("div");c.innerHTML='<img src="'+b.imgpath+'cal.gif" id="'+this.s_iconId+'" onclick="A_TCALS[\''+this.s_id+'\'].f_toggle()" class="tcalIcon" alt="Open Calendar" />';a.place.appendChild(c.firstChild);this.e_icon=f_getElement(this.s_iconId)}this.a_cfg=a;this.a_tpl=b}
function f_tcalShow(){if(!this.a_cfg.controlname)throw"TC: control name is not specified";if(this.a_cfg.formname){var a=document.forms[this.a_cfg.formname];if(!a)throw"TC: form '"+this.a_cfg.formname+"' can not be found";this.e_input=a.elements[this.a_cfg.controlname];this.a_cfg.intervalupdatecont&&this.a_cfg.intervalpair&&2==this.a_cfg.intervalpair.length&&(this.intervalpair=[a.elements[this.a_cfg.intervalpair[0]],a.elements[this.a_cfg.intervalpair[1]]],this.intervalupdatecont=a.elements[this.a_cfg.intervalupdatecont])}else this.e_input=
f_getElement(this.a_cfg.controlname),this.a_cfg.intervalpair&&2==this.a_cfg.intervalpair.length&&(this.intervalpair=[f_getElement(this.a_cfg.intervalpair[0]),f_getElement(this.a_cfg.intervalpair[1])]),this.intervalupdatecont=f_getElement(this.a_cfg.intervalupdatecont);if(!this.e_input||!this.e_input.tagName||"INPUT"!=this.e_input.tagName)throw"TC: element '"+this.a_cfg.controlname+"' does not exist in "+(this.a_cfg.formname?"form '"+this.a_cfg.controlname+"'":"this document");this.e_div=f_getElement("tcal");
this.e_div||(this.e_div=document.createElement("DIV"),this.e_div.id="tcal",document.body.appendChild(this.e_div));this.e_shade=f_getElement("tcalShade");this.e_shade||(this.e_shade=document.createElement("DIV"),this.e_shade.id="tcalShade",document.body.appendChild(this.e_shade));this.e_iframe=f_getElement("tcalIF");b_ieFix&&!this.e_iframe&&(this.e_iframe=document.createElement("IFRAME"),this.e_iframe.style.filter="alpha(opacity=0)",this.e_iframe.id="tcalIF",this.e_iframe.src=this.a_tpl.imgpath+"pixel.gif",
document.body.appendChild(this.e_iframe));f_tcalHideAll();this.e_icon=f_getElement(this.s_iconId);this.e_div.style.display="block";this.e_shade.style.display="block";this.e_iframe&&(this.e_iframe.style.display="block");this.f_update()&&(this.e_div.style.visibility="visible",this.e_div.style.display="block",this.e_shade.style.visibility="visible",this.e_shade.style.display="block",this.e_iframe&&(this.e_iframe.style.visibility="visible",this.e_iframe.style.display="block"),this.e_icon.src=this.a_tpl.imgpath+
"no_cal.gif",this.e_icon.title="Close Calendar",this.b_visible=!0)}
function f_tcalHide(a){a&&(this.e_input.value=this.f_generDate(new Date(a)),this.intervalpair&&this.intervalupdatecont&&""!=this.intervalpair[0].value&&""!=this.intervalpair[1].value?this.intervalupdatecont.value=this.intervalpair[0].value+" -- "+this.intervalpair[1].value:this.intervalupdatecont&&(this.intervalupdatecont.value=""),f_tcalFireEvent(this.e_input,"change"));this.b_visible&&(this.e_iframe&&(this.e_iframe.style.visibility="hidden",this.e_iframe.style.display="none"),this.e_shade&&(this.e_shade.style.visibility=
"hidden",this.e_shade.style.display="none"),this.e_div.style.visibility="hidden",this.e_div.style.display="none",this.e_icon=f_getElement(this.s_iconId),this.e_icon.src=this.a_tpl.imgpath+"cal.gif",this.e_icon.title="Open Calendar",this.b_visible=!1)}function f_tcalToggle(){return this.b_visible?this.f_hide():this.f_show()}
function f_tcalUpdate(a){var b=new Date;b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0);var b=this.a_cfg.today?this.f_parseDate(this.a_cfg.today):b,c=""==this.e_input.value?this.a_cfg.selected?this.f_parseDate(this.a_cfg.selected):b:this.f_parseDate(this.e_input.value);a?"number"==typeof a?a=new Date(a):"string"==typeof a&&this.f_parseDate(a):a=c;if(!a)return!1;var d=new Date(a);d.setDate(1);d.setDate(1-(7+d.getDay()-this.a_tpl.weekstart)%7);var e,f='<table class="ctrl"><tbody><tr>'+
(this.a_tpl.yearscroll?"<td"+this.f_relDate(a,-1,"y")+' title="Previous Year"><img src="'+this.a_tpl.imgpath+'prev_year.gif" /></td>':"")+"<td"+this.f_relDate(a,-1)+' title="Previous Month"><img src="'+this.a_tpl.imgpath+'prev_mon.gif" /></td><th>'+this.a_tpl.months[a.getMonth()]+" "+a.getFullYear()+"</th><td"+this.f_relDate(a,1)+' title="Next Month"><img src="'+this.a_tpl.imgpath+'next_mon.gif" /></td>'+(this.a_tpl.yearscroll?"<td"+this.f_relDate(a,1,"y")+' title="Next Year"><img src="'+this.a_tpl.imgpath+
'next_year.gif" /></td></td>':"")+'</tr></tbody></table><table><tbody><tr class="wd">';for(e=0;7>e;e++)f+="<th>"+this.a_tpl.weekdays[(this.a_tpl.weekstart+e)%7]+"</th>";for(var f=f+"</tr>",h=new Date(d);h.getMonth()==a.getMonth()||h.getMonth()==d.getMonth();){for(var f=f+"<tr>",i=0;7>i;i++){e=[];h.getMonth()!=a.getMonth()&&(e[e.length]="othermonth");if(0==h.getDay()||6==h.getDay())e[e.length]="weekend";h.valueOf()==b.valueOf()&&(e[e.length]="today");h.valueOf()==c.valueOf()&&(e[e.length]="selected");
f+="<td onclick=\"A_TCALS['"+this.s_id+"'].f_hide("+h.valueOf()+')"'+(e.length?' class="'+e.join(" ")+'">':">")+h.getDate()+"</td>";h.setDate(h.getDate()+1)}f+="</tr>"}this.e_div.innerHTML=f+"</tbody></table>";a=this.e_div.offsetWidth;b=this.e_div.offsetHeight;c=f_getPosition(this.e_icon,"Top")+this.e_icon.offsetHeight;d=f_getPosition(this.e_icon,"Left")-a+this.e_icon.offsetWidth;0>d&&(d=0);this.e_div.style.left=d+"px";this.e_div.style.top=c+"px";this.e_shade.style.width=a+8+"px";this.e_shade.style.left=
d-1+"px";this.e_shade.style.top=c-1+"px";this.e_shade.innerHTML=b_ieFix?'<table><tbody><tr><td rowspan="2" colspan="2" width="6"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td><td width="7" height="7" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\''+this.a_tpl.imgpath+"shade_tr.png', sizingMethod='scale');\"><img src=\""+this.a_tpl.imgpath+'pixel.gif"></td></tr><tr><td height="'+(b-7)+'" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\''+this.a_tpl.imgpath+
"shade_mr.png', sizingMethod='scale');\"><img src=\""+this.a_tpl.imgpath+'pixel.gif"></td></tr><tr><td width="7" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\''+this.a_tpl.imgpath+"shade_bl.png', sizingMethod='scale');\"><img src=\""+this.a_tpl.imgpath+'pixel.gif"></td><td style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\''+this.a_tpl.imgpath+'shade_bm.png\', sizingMethod=\'scale\');" height="7" align="left"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td><td style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\''+
this.a_tpl.imgpath+"shade_br.png', sizingMethod='scale');\"><img src=\""+this.a_tpl.imgpath+'pixel.gif"></td></tr><tbody></table>':'<table><tbody><tr><td rowspan="2" width="6"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td><td rowspan="2"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td><td width="7" height="7"><img src="'+this.a_tpl.imgpath+'shade_tr.png"></td></tr><tr><td background="'+this.a_tpl.imgpath+'shade_mr.png" height="'+(b-7)+'"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td></tr><tr><td><img src="'+
this.a_tpl.imgpath+'shade_bl.png"></td><td background="'+this.a_tpl.imgpath+'shade_bm.png" height="7" align="left"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td><td><img src="'+this.a_tpl.imgpath+'shade_br.png"></td></tr><tbody></table>';this.e_iframe&&(this.e_iframe.style.left=d+"px",this.e_iframe.style.top=c+"px",this.e_iframe.style.width=a+6+"px",this.e_iframe.style.height=b+6+"px");return!0}
function f_getPosition(a,b){for(var c=0,d,e=a;e;)d=e["offset"+b],c+=d,e=e.offsetParent;b_ieMac?c+=parseInt(document.body[b.toLowerCase()+"Margin"]):b_safari&&(c-=d);for(e=a;e!=document.body;)(d=e["scroll"+b])&&"scroll"==e.style.overflow&&(c-=d),e=e.parentNode;return c}function f_tcalRelDate(a,b,c){var c="y"==c?"FullYear":"Month",d=new Date(a);d["set"+c](a["get"+c]()+b);d.getDate()!=a.getDate()&&d.setDate(0);return" onclick=\"A_TCALS['"+this.s_id+"'].f_update("+d.valueOf()+')"'}
function f_tcalHideAll(){for(var a=0;a<window.A_TCALSIDX.length;a++)window.A_TCALSIDX[a].f_hide()}function f_tcalFireEvent(a,b){var c;if("undefined"!==typeof jQuery)jQuery(a).trigger(b);else{if(document.createEventObject)return c=document.createEventObject(),a.fireEvent("on"+b,c);c=document.createEvent("HTMLEvents");c.initEvent(b,!0,!0);return!a.dispatchEvent(c)}}f_getElement=document.all?function(a){return document.all[a]}:function(a){return document.getElementById(a)};
var s_userAgent=navigator.userAgent.toLowerCase(),re_webkit=/WebKit\/(\d+)/i,b_mac=-1!=s_userAgent.indexOf("mac"),b_ie5=-1!=s_userAgent.indexOf("msie 5"),b_ie6=-1!=s_userAgent.indexOf("msie 6")&&-1==s_userAgent.indexOf("opera"),b_ieFix=b_ie5||b_ie6,b_ieMac=b_mac&&b_ie5,b_safari=b_mac&&re_webkit.exec(s_userAgent)&&500>Number(RegExp.$1);
$(function(){$("input.init-calendar").each(function(){new tcal({controlname:$(this).attr("id"),place:$(this).parent().get(0),lang:"ru"})});$("input.init-calendar-interval").each(function(){for(var a=$(this).attr("id"),b=0;2>b;++b){var c=f_getElement(a+"["+b+"]");new tcal({controlname:c.id,place:c.parentNode,lang:"ru",intervalpair:[a+"[0]",a+"[1]"],intervalupdatecont:a})}})});
var Comments={lang:{alertNeedSelect:"\u0412\u044b\u0434\u0435\u043b\u0438\u0442\u0435 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442 \u0446\u0438\u0442\u0438\u0440\u0443\u0435\u043c\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430."},get_selected:function(){var a="";window.getSelection?a=window.getSelection():document.selection?a=document.selection.createRange().text:document.getSelection&&(a=document.getSelection());return a},ac:function(a){try{var b=document.getElementById("to"+a);b.innerText?
to=b.innerText:b.innerHTML&&(to=b.innerHTML);to=to.replace(/<[^>]+>/g,"");text=document.commentform.text.value;-1==text.indexOf(to)&&(0<text.length&&(text+="\n\n"),text+=to+"\n\n",document.commentform.text.value=text);document.commentform.text.focus()}catch(c){}},qc:function(a){try{if(document.getElementById("quote"+a)){var b=new String(this.get_selected());if(""==b)alert(this.lang.alertNeedSelect);else{b=b.replace(/\r\n/g,"\n");b=b.replace(/\r/g,"\n");b=b.replace(/\n/g,"\n> ");1E3<b.length&&(b=b.substring(0,
1E3)+"...");b.match(/^\s*[^>]/)&&(b=b.replace(/^\s*/,"> "));var b=b.replace(/\s*$/,""),c=document.getElementById("to"+a);c.innerText?to=c.innerText:c.innerHTML&&(to=c.innerHTML);to=to.replace(/<[^>]+>/g,"");text=document.commentform.text.value;-1==text.indexOf(to)&&(0<text.length&&(text+="\n\n"),text+=to);text+="\n\n"+b+"\n\n";document.commentform.text.value=text;document.commentform.text.focus()}}}catch(d){}}};
